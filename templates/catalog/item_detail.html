{% extends 'base.html' %}
{% block title %}{{ code }} - {{ item.name }} - BrickVault{% endblock %}

{% block content %}
{% if item %}
<div class="max-w-6xl mx-auto">
    <div class="flex flex-col md:flex-row gap-8">
        <div class="md:w-1/2">
            <div class="aspect-square rounded-2xl overflow-hidden border border-slate-200 dark:border-slate-700 bg-slate-100 dark:bg-slate-800 shadow-lg">
                {% if item.image %}
                <img src="{{ item.image }}" alt="{{ item.name }}" class="w-full h-full object-cover">
                {% else %}
                <div class="w-full h-full flex items-center justify-center text-slate-400 dark:text-slate-500">
                    <svg class="w-32 h-32" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14"/></svg>
                </div>
                {% endif %}
            </div>
            {% if item.images %}
            <div class="flex gap-2 mt-4 overflow-x-auto pb-2">
                {% for img in item.images %}
                <img src="{{ img }}" alt="" class="w-20 h-20 object-cover rounded-xl border border-slate-200 dark:border-slate-700 flex-shrink-0">
                {% endfor %}
            </div>
            {% endif %}
        </div>
        <div class="md:w-1/2">
            <span class="inline-block font-mono text-brick-500 dark:text-brick-400 text-lg px-3 py-1 rounded-lg bg-brick-50 dark:bg-brick-500/10">{{ code }}</span>
            <h1 class="text-3xl font-bold text-slate-900 dark:text-white mt-3">{{ item.name }}</h1>
            {% if item.themes %}
            <div class="flex flex-wrap gap-2 mt-2">
                {% for theme in item.themes %}
                <a href="{% url 'catalog:browse' %}?category={{ theme.id }}" class="text-slate-600 dark:text-slate-400 hover:text-brick-500 dark:hover:text-brick-400 transition-colors">{{ theme.name }}</a>{% if not forloop.last %},{% endif %}
                {% endfor %}
            </div>
            {% endif %}
            {% if item.price %}
            <p class="text-3xl font-bold text-brick-500 dark:text-brick-400 mt-6">${{ item.price }}</p>
            {% else %}
            <p class="text-slate-500 dark:text-slate-400 mt-6">Price on request</p>
            {% endif %}
            {% if user.is_authenticated %}
            <div class="flex flex-wrap gap-3 mt-6">
                {% if in_watchlist %}
                <a href="{% url 'catalog:watchlist_remove' code %}" class="px-4 py-2.5 rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 hover:bg-red-50 dark:hover:bg-red-500/10 text-slate-700 dark:text-slate-300 hover:text-red-500 dark:hover:text-red-400 transition-colors">Remove from Watchlist</a>
                <a href="{% url 'catalog:watchlist_toggle_favorite' code %}" class="px-4 py-2.5 rounded-xl border transition-colors {% if is_favorite %}bg-brick-50 dark:bg-brick-500/20 border-brick-500 text-brick-500 dark:text-brick-400{% else %}border-slate-200 dark:border-slate-700 hover:border-brick-500/50 text-slate-600 dark:text-slate-400 hover:text-brick-500 dark:hover:text-brick-400{% endif %}">
                    {% if is_favorite %}★ Favorited{% else %}☆ Add to Favorites{% endif %}
                </a>
                {% else %}
                <a href="{% url 'catalog:watchlist_add' code %}" class="px-4 py-2.5 rounded-xl bg-brick-500 hover:bg-brick-600 text-white font-medium shadow-sm hover:shadow transition-all">Add to Watchlist</a>
                {% endif %}
            </div>
            {% else %}
            <p class="text-slate-500 dark:text-slate-400 mt-6"><a href="{% url 'accounts:login' %}" class="text-brick-500 dark:text-brick-400 hover:underline font-medium">Log in</a> to add to watchlist</p>
            {% endif %}
            {% if item.description %}
            <div class="mt-8">
                <h2 class="text-lg font-semibold text-slate-900 dark:text-white mb-2">Description</h2>
                <p class="text-slate-600 dark:text-slate-400 whitespace-pre-wrap leading-relaxed">{{ item.description }}</p>
            </div>
            {% endif %}
        </div>
    </div>

    {% if sellers %}
    <div class="mt-12">
        <h2 class="text-2xl font-bold text-slate-900 dark:text-white mb-6">Available Sellers</h2>
        <div class="overflow-x-auto rounded-2xl border border-slate-200 dark:border-slate-700 shadow-sm">
            <table class="w-full">
                <thead class="bg-slate-50 dark:bg-slate-800/50">
                    <tr>
                        <th class="text-left px-4 py-3 text-slate-600 dark:text-slate-400 font-medium text-sm">Seller</th>
                        <th class="text-left px-4 py-3 text-slate-600 dark:text-slate-400 font-medium text-sm">Source</th>
                        <th class="text-left px-4 py-3 text-slate-600 dark:text-slate-400 font-medium text-sm">Price</th>
                        <th class="text-left px-4 py-3 text-slate-600 dark:text-slate-400 font-medium text-sm">Quantity</th>
                        <th class="text-left px-4 py-3 text-slate-600 dark:text-slate-400 font-medium text-sm">Condition</th>
                        <th class="text-left px-4 py-3 text-slate-600 dark:text-slate-400 font-medium text-sm">Complete</th>
                        <th class="text-left px-4 py-3 text-slate-600 dark:text-slate-400 font-medium text-sm">Country</th>
                        <th class="text-left px-4 py-3 text-slate-600 dark:text-slate-400 font-medium text-sm"></th>
                    </tr>
                </thead>
                <tbody>
                    {% for seller in sellers %}
                    <tr class="border-t border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800/30 transition-colors">
                        <td class="px-4 py-3">
                            <span class="text-slate-900 dark:text-white font-medium">{{ seller.name|default:"—" }}</span>
                            {% if seller.description %}
                            <p class="text-slate-500 dark:text-slate-400 text-sm mt-0.5 line-clamp-2">{{ seller.description }}</p>
                            {% endif %}
                        </td>
                        <td class="px-4 py-3">
                            {% include 'components/badge.html' with text=seller.source variant="brick" %}
                        </td>
                        <td class="px-4 py-3">
                            {% if seller.usd_price %}
                            <span class="text-brick-500 dark:text-brick-400 font-bold">${{ seller.usd_price }}</span>
                            {% endif %}
                            {% if seller.real_price %}<span class="text-slate-500 dark:text-slate-400 text-sm ml-1">({{ seller.real_price }})</span>{% endif %}
                        </td>
                        <td class="px-4 py-3 text-slate-600 dark:text-slate-400">{{ seller.quantity|default:"—" }}</td>
                        <td class="px-4 py-3 text-slate-600 dark:text-slate-400">{{ seller.condition|default:"—" }}</td>
                        <td class="px-4 py-3 text-slate-600 dark:text-slate-400">{{ seller.complete|default:"—" }}</td>
                        <td class="px-4 py-3 text-slate-600 dark:text-slate-400">{{ seller.country|default:"—" }}</td>
                        <td class="px-4 py-3">
                            {% if seller.buy_url %}
                            <a href="{{ seller.buy_url }}" target="_blank" rel="noopener" class="text-brick-500 dark:text-brick-400 hover:text-brick-600 dark:hover:text-brick-300 font-medium transition-colors">Buy →</a>
                            {% else %}
                            —
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}
</div>
{% else %}
{% url 'catalog:browse' as browse_url %}
{% include 'components/empty_state.html' with title="Set not found" message="The set you're looking for doesn't exist or has been removed." action_url=browse_url action_text="Browse catalog" %}
{% endif %}
{% endblock %}
